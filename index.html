<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Will You Be My Valentine?</title>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <main class="stage">
      <img
        class="letter"
        id="letter-gif"
        src="Gifs/Letter.gif"
        alt="Animated letter with hearts"
      />
      <h1 id="main-title">Will you be my Valentine?</h1>
      <p class="menu-link" id="menu-link" hidden>
        <a href="https://theboweryhotel.com/dinner-menu/" target="_blank" rel="noopener noreferrer"
          >https://theboweryhotel.com/dinner-menu/</a
        >
      </p>

      <div class="buttons" id="buttons-row">
        <button class="btn yes" id="yes-button" type="button">Yes</button>
        <button class="btn no" id="no-button" type="button">No</button>
      </div>
    </main>

    <script>
      const stage = document.querySelector(".stage");
      const letter = document.getElementById("letter-gif");
      const title = document.getElementById("main-title");
      const menuLink = document.getElementById("menu-link");
      const yesButton = document.getElementById("yes-button");
      const noButton = document.getElementById("no-button");

      let accepted = false;

      const moveNoButton = () => {
        if (accepted) {
          return;
        }

        const stageRect = stage.getBoundingClientRect();
        const buttonRect = noButton.getBoundingClientRect();
        const padding = 16;

        const maxX = Math.max(0, stageRect.width - buttonRect.width - padding * 2);
        const maxY = Math.max(0, stageRect.height - buttonRect.height - padding * 2);

        const x = padding + Math.random() * maxX;
        const y = padding + Math.random() * maxY;

        noButton.classList.add("floating");
        noButton.style.left = `${x}px`;
        noButton.style.top = `${y}px`;
      };

      const acceptValentine = () => {
        if (accepted) {
          return;
        }

        accepted = true;
        yesButton.classList.add("fade-out");
        noButton.classList.add("fade-out");
        title.textContent = "Dinner @ Gemma 4:30";
        menuLink.hidden = false;
        letter.classList.add("swapping");

        window.setTimeout(() => {
          letter.src = "Gifs/Seal.gif";
          letter.alt = "Animated seal with hearts";
          letter.classList.remove("swapping");
        }, 220);
      };

      noButton.addEventListener("mouseenter", moveNoButton);
      noButton.addEventListener("touchstart", moveNoButton, { passive: true });
      yesButton.addEventListener("click", acceptValentine);
    </script>
  </body>
</html>
